<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://unpkg.com/html5-qrcode@2.0.9/dist/html5-qrcode.min.js"></script>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <title>Hello, world!</title>
  </head>
  <body>
    <!-- <div>
      <img src="{{ url_for('video') }}" width="50%"/>
      <h6>{{barcodeData}}</h6> -->
    <!-- </div>  -->

    <!-- <div id="qr-reader" style="width: 600px"></div> -->

    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/dynamsoft-javascript-barcode@9.0.0/dist/dbr.js"></script>
    <script>
          // specify a license, you can visit https://www.dynamsoft.com/customer/license/trialLicense?utm_source=guide&product=dbr&package=js to get your own trial license good for 30 days. 
          Dynamsoft.DBR.BarcodeScanner.license = 'DLS2eyJvcmdhbml6YXRpb25JRCI6IjIwMDAwMSJ9';
          // initializes and uses the library
          (async () => {
              let scanner = await Dynamsoft.DBR.BarcodeScanner.createInstance();
              scanner.onFrameRead = results => {
                  if (results.length > 0) 
                  {
                    console.log(results[0].barcodeText);
                    // myFunction(results[0].barcodeText);
                  }
                  
              };
              var all = [];
              console.log("hii");
              scanner.onUniqueRead = (txt, result) => {
                  // localStorage.setItem("lastname", "Smith");
                  // var barcodename=txt;
                  all.push(txt);
                  // alert("Barcode is detected");
                  myFunction(result.barcodeText);
                  // if(isInArray(txt,all)){
                  //   console.log("exists");
                  // }else{
                  // myFunction(txt);
                  // }
                  // document.getElementById("test").innerHTML = txt
              };

              window.onload = function(){
                 document.getElementById('output').innerHTML = barcodename;
};

              await scanner.show();
          })();

var sum = [];
var total = 0;
// var txt = 3456789;
var demoData = {
        '3748721110': {
            name: 'Butter milk',
            price: 12
        },
        '4728495837': {
            name: 'Ice Cream',
            price: 20
        },
        '6849526349':{
          name:'Red Bull',
          price: 120
        },
        '3147392857': {
            name: 'Lays',
            price: 30
        },
        '4729475256': {
            name: 'Maggi',
            price: 20
        }
    };

    function add(accumulator, a) {
        return accumulator + a;
    }

  function myFunction(txt) {
    console.log('==========================',txt);
    var table = document.getElementById("myTable");
    console.log(table);
    var totalRowCount = table.rows.length; // 5

    for (const value in demoData) {
       // console.log(value);
        if (value == txt) {
         //   console.log(demoData[value]);
            var newItem = demoData[value];
            sum.push(newItem.price);
            console.log(sum);     
   
            total = sum.reduce(add, 0);
            document.getElementById('total').innerHTML = total;

            var row = table.insertRow(totalRowCount);
    var cell1 = row.insertCell(0);
    var cell2 = row.insertCell(1);
    var cell3 = row.insertCell(2);
    var cell4 = row.insertCell(3);
    // var cell5 = row.insertCell(4);
    var deleteButton = `<input type="button" value="Delete" onclick="deleteRow(this)"/>`;
    cell1.innerHTML = `<span class="index">` + totalRowCount + `</span>`;
    cell2.innerHTML = newItem.name;
    cell3.innerHTML = newItem.price;
    // cell4.innerHTML = "NEW CELL4";
    cell4.innerHTML = deleteButton;
    break;
        }else{
         console.log('Barcode not found');
        }
    }
   
}

function sleep(milliseconds) {
  var start = new Date().getTime();
  for (var i = 0; i < 1e7; i++) {
    if ((new Date().getTime() - start) > milliseconds){
      break;
    }
  }
}

function isInArray(value, array) {
  return array.indexOf(value) > -1;
}

function deleteRow(btn) {
  var row = btn.parentNode.parentNode;
  var cells = row.getElementsByTagName("td");
  var deletedvalue=cells[2].innerText;
  row.parentNode.removeChild(row);
  sum_total= document.getElementById('total').innerHTML;
  console.log(sum_total);
 // var totalRowCount = table.rows.length;
  let revised_total= sum_total - deletedvalue;
  console.log(revised_total);
  document.getElementById('total').innerHTML = revised_total;
  recountRows();
}
function recountRows() {
                var index = 1;
                $('.index').each(function () {
                    $(this).html(index);
                    index++;
                });
            }

      </script>


<!-- <div class="table-responsive">
  <table class="table" id="myTable">
    <thead>
      <tr>
        <th scope="col">#</th>
        <th scope="col">ID</th>
        <th scope="col">BARCODE</th>
        <th scope="col">Handle</th>
        <th scope="col">Handle</th>
      </tr>
    </thead>
    <tbody>
    </tbody>
  </table>
  <button type="button" onclick="myFunction()">Try it</button>
  </div> -->

  <div class="container mt-5">
    <div class="d-flex justify-content-center row">
        <div class="col-md-8">
            <div class="p-3 bg-white rounded">
                <div class="row" style="align-items: baseline;">
                    <div class="col-md-6">
                        <h4 class="text-uppercase">Invoice</h>
                    </div>
                    <div class="col-md-6 text-right mt-3">
                        <h2 class="text-danger mb-0" style="float: right;">SwiftBuy</h2>
                    </div>
                </div>
                <div class="mt-3">
                    <div class="table-responsive">
                        <table class="table" id="myTable">
                            <thead>
                                <tr>
                                    <!-- <th>Product</th> -->
                                    <th>Item No</th>
                                    <th>Product</th>
                                    <th>Price</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </div> 
            </div>
               Total: <div class="text-right mb-3" id="total"></div>
                <div class="text-right mb-3"><button class="btn btn-danger btn-sm mr-5" type="button">Pay Now</button></div>
                <a href="http://20.20.1.113:3000/login">
                  <button>Payment</button>
              </a>

              </div>
        </div>
    </div>
</div>
<!-- <h1>Hello Webcam</h1>
<div id="test"></div>
<table class="table">
  <thead>
    <tr>
      <th scope="col">Web</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><p id="output"></p></td>
    </tr>
  </tbody>
</table> -->
    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
    -->
  </body>
</html>